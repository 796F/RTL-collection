<HTML>
<TITLE>
 ethz_groestl/simvectors/ethz_groestl_stimuli.pl
</TITLE>
<BODY>
<PRE>
<I><FONT COLOR=#808080>#! /usr/sepp/bin/perl -w</FONT></I>

<I><FONT COLOR=#808080>############################################################
## Copyright: 2011 Integrated Sytems Laboratory, ETH Zurich
##            http://www.iis.ee.ethz.ch/~sha3
############################################################</FONT></I>
<B>use</B> <B>strict</B>;

<I><FONT COLOR=#808080># v0.1 - kgf@ee.ethz.ch - Wed Aug 17 18:39:57 CEST 2011</FONT></I>
<I><FONT COLOR=#808080># - copy from ethz_blake v0.1</FONT></I>
<I><FONT COLOR=#808080>#   adapted for groestl</FONT></I>

<I><FONT COLOR=#808080># make sure the lengths are ok later on</FONT></I>

<I><FONT COLOR=#808080>## CONSTANTS</FONT></I>
<B><FONT COLOR=AA0000>my</FONT></B> <I><FONT COLOR=0000FF>$HASH_BLOCK_SIZE</FONT></I>= 512;  <I><FONT COLOR=#808080># Keccak SHA-256 version</FONT></I>
<B><FONT COLOR=AA0000>my</FONT></B> <I><FONT COLOR=0000FF>$MIN_PADDING_SIZE</FONT></I>= 80;  <I><FONT COLOR=#808080># this is not completely correct. Min size is </FONT></I>
                           <I><FONT COLOR=#808080># 1 + 64 but it is so much easier to generate 16 + 64</FONT></I>

<I><FONT COLOR=#808080>## let us extract the information first </FONT></I>
<B><FONT COLOR=AA0000>my</FONT></B> <I><FONT COLOR=0000FF>@L</FONT></I>;  <I><FONT COLOR=#808080># length array</FONT></I>
<B><FONT COLOR=AA0000>my</FONT></B> <I><FONT COLOR=0000FF>@M</FONT></I>;  <I><FONT COLOR=#808080># message array</FONT></I>
<B><FONT COLOR=AA0000>my</FONT></B> <I><FONT COLOR=0000FF>@D</FONT></I>;  <I><FONT COLOR=#808080># digest array</FONT></I>

<I><FONT COLOR=#808080># steal all the information</FONT></I>
<I><FONT COLOR=#808080># Note: if one of the entries MD, Len, Msg is missing trouble will arise</FONT></I>

<B><FONT COLOR=AA0000>open</FONT></B> (S, "< expresp.txt");
<B>while</B> (S){
   <B><FONT COLOR=AA0000>push</FONT></B> (<I><FONT COLOR=0000FF>@L</FONT></I>,<I><FONT COLOR=0000FF>$1</FONT></I>) <B>if</B> (/^\s*Len\s*=\s*([0-9]+)/i);
   <B><FONT COLOR=AA0000>push</FONT></B> (<I><FONT COLOR=0000FF>@M</FONT></I>,<I><FONT COLOR=0000FF>$1</FONT></I>) <B>if</B> (/^\s*Msg\s*=\s*([0-9A-F]+)/i);
   <B><FONT COLOR=AA0000>push</FONT></B> (<I><FONT COLOR=0000FF>@D</FONT></I>,<I><FONT COLOR=0000FF>$1</FONT></I>) <B>if</B> (/^\s*MD\s*=\s*([0-9A-F]+)/i);
}
<B><FONT COLOR=AA0000>close</FONT></B>(S);


  <B><FONT COLOR=AA0000>my</FONT></B> <I><FONT COLOR=0000FF>$date</FONT></I>= `date`;
  <B><FONT COLOR=AA0000>chomp</FONT></B> (<I><FONT COLOR=0000FF>$date</FONT></I>);

<B><FONT COLOR=AA0000>print</FONT></B> <<"BUGU";
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Test vectors <B>for</B> ETHZ BLAKE 
%%   generated by ethz_blake_stimuli.pl
%%   on <I><FONT COLOR=0000FF>$date</FONT></I>
%% 
BUGU

<I><FONT COLOR=#808080>## loop over all read messages </FONT></I>
<B>for</B> <B><FONT COLOR=AA0000>my</FONT></B> <I><FONT COLOR=0000FF>$i</FONT></I> (0..$<I><FONT COLOR=#808080>#L){</FONT></I>
 <I><FONT COLOR=#808080>## how many blocks will we need</FONT></I>
 <B><FONT COLOR=AA0000>my</FONT></B> <I><FONT COLOR=0000FF>$num_blocks</FONT></I>=<B><FONT COLOR=AA0000>int</FONT></B> ((<I><FONT COLOR=0000FF>$L</FONT></I>[<I><FONT COLOR=0000FF>$i</FONT></I>] + <I><FONT COLOR=0000FF>$MIN_PADDING_SIZE</FONT></I> - 1) / <I><FONT COLOR=0000FF>$HASH_BLOCK_SIZE</FONT></I>) +1; 

 <I><FONT COLOR=#808080>## now let us determine the padding</FONT></I>
 <I><FONT COLOR=#808080>## It is very easy to calculate this provided the pad size is at least 16</FONT></I>
 <I><FONT COLOR=#808080>## it is a restriction at the moment but it works easily.. </FONT></I>
 <I><FONT COLOR=#808080>## for other lengths we need a more elaborate code.. </FONT></I>
 <B><FONT COLOR=AA0000>my</FONT></B> <I><FONT COLOR=0000FF>$zero_cnt</FONT></I> = ((<I><FONT COLOR=0000FF>$HASH_BLOCK_SIZE</FONT></I> * <I><FONT COLOR=0000FF>$num_blocks</FONT></I>) - <I><FONT COLOR=0000FF>$L</FONT></I>[<I><FONT COLOR=0000FF>$i</FONT></I>] - <I><FONT COLOR=0000FF>$MIN_PADDING_SIZE</FONT></I>) / 8;
 <B><FONT COLOR=AA0000>my</FONT></B> <I><FONT COLOR=0000FF>$pad</FONT></I> = "80"."00" x <I><FONT COLOR=0000FF>$zero_cnt</FONT></I>."00";

<I><FONT COLOR=#808080># my $len = unpack ("H16", pack("N2",$L[$i]));</FONT></I>
<I><FONT COLOR=#808080># my $len = sprintf("%016x\n", $L[$i]);</FONT></I>
<I><FONT COLOR=#808080># groestl requires number of blocks in binary not length</FONT></I>
 <B><FONT COLOR=AA0000>my</FONT></B> <I><FONT COLOR=0000FF>$len</FONT></I> = sprintf("<I><FONT COLOR=0000FF>%016x</FONT></I>", <I><FONT COLOR=0000FF>$num_blocks</FONT></I>);
 <I><FONT COLOR=0000FF>$pad</FONT></I>=<I><FONT COLOR=0000FF>$pad</FONT></I>.<I><FONT COLOR=0000FF>$len</FONT></I>;

<I><FONT COLOR=#808080>#print $L[$i]." ".$len." ".$num_blocks." ".$zero_cnt."\n";</FONT></I>
<I><FONT COLOR=#808080>#print "$zero_cnt = (($HASH_BLOCK_SIZE * $num_blocks) - $L[$i] - $MIN_PADDING_SIZE)\n";</FONT></I>


<I><FONT COLOR=#808080>## these two are so that the reports look cute</FONT></I>
<B><FONT COLOR=AA0000>my</FONT></B> <I><FONT COLOR=0000FF>$pretty_i</FONT></I>   = <I><FONT COLOR=0000FF>$i</FONT></I> + 1;
<B><FONT COLOR=AA0000>my</FONT></B> <I><FONT COLOR=0000FF>$pretty_len</FONT></I> = $<I><FONT COLOR=#808080>#L + 1;</FONT></I>

<I><FONT COLOR=#808080># comment character is '%' n the testbench</FONT></I>

<B><FONT COLOR=AA0000>print</FONT></B> <<"BUGU";
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% vector <I><FONT COLOR=0000FF>$pretty_i</FONT></I> of <I><FONT COLOR=0000FF>$pretty_len</FONT></I>
%% Length  = <I><FONT COLOR=0000FF>$L</FONT></I>[<I><FONT COLOR=0000FF>$i</FONT></I>], Number of <I><FONT COLOR=0000FF>$HASH_BLOCK_SIZE</FONT></I> bit blocks = <I><FONT COLOR=0000FF>$num_blocks</FONT></I>, Padding = <I><FONT COLOR=0000FF>$pad</FONT></I>
%% Message = <I><FONT COLOR=0000FF>$M</FONT></I>[<I><FONT COLOR=0000FF>$i</FONT></I>]
%% Digest  = <I><FONT COLOR=0000FF>$D</FONT></I>[<I><FONT COLOR=0000FF>$i</FONT></I>]
BUGU

 <I><FONT COLOR=#808080>## add the pad and the length to the message</FONT></I>
 <I><FONT COLOR=0000FF>$M</FONT></I>[<I><FONT COLOR=0000FF>$i</FONT></I>]=<I><FONT COLOR=0000FF>$M</FONT></I>[<I><FONT COLOR=0000FF>$i</FONT></I>].<I><FONT COLOR=0000FF>$pad</FONT></I>;


 <I><FONT COLOR=#808080>## now loop over number of blocks</FONT></I>
 <B>for</B> <B><FONT COLOR=AA0000>my</FONT></B> <I><FONT COLOR=0000FF>$j</FONT></I> (1..<I><FONT COLOR=0000FF>$num_blocks</FONT></I>){
   <I><FONT COLOR=#808080>## this is the part of the message that goes out</FONT></I>
   <B><FONT COLOR=AA0000>my</FONT></B> <I><FONT COLOR=0000FF>$<B>sub</B></FONT></I>=substr(<I><FONT COLOR=0000FF>$M</FONT></I>[<I><FONT COLOR=0000FF>$i</FONT></I>],(<I><FONT COLOR=0000FF>$j</FONT></I>-1)*(<I><FONT COLOR=0000FF>$HASH_BLOCK_SIZE</FONT></I>/4),(<I><FONT COLOR=0000FF>$HASH_BLOCK_SIZE</FONT></I>/4));
<I><FONT COLOR=#808080>##print "%%..  ".unpack("H*",pack("H*",$sub))."\n"; </FONT></I>
 
   <I><FONT COLOR=#808080>## generate the output</FONT></I>
   <B><FONT COLOR=AA0000>print</FONT></B> <B><FONT COLOR=AA0000>unpack</FONT></B>("B*",<B><FONT COLOR=AA0000>pack</FONT></B>("H*",<I><FONT COLOR=0000FF>$<B>sub</B></FONT></I>))." ";            <I><FONT COLOR=#808080># this is the block input</FONT></I>
   <I><FONT COLOR=#808080>## are we in the last block </FONT></I>
   <B>if</B> (<I><FONT COLOR=0000FF>$j</FONT></I> eq <I><FONT COLOR=0000FF>$num_blocks</FONT></I>){
     <B><FONT COLOR=AA0000>print</FONT></B> "1 ".<B><FONT COLOR=AA0000>unpack</FONT></B>("B*",<B><FONT COLOR=AA0000>pack</FONT></B>("H*",<I><FONT COLOR=0000FF>$D</FONT></I>[<I><FONT COLOR=0000FF>$i</FONT></I>]))."\n";  <I><FONT COLOR=#808080># set last and compare</FONT></I>
   }
   <B>else</B>{
     <B><FONT COLOR=AA0000>print</FONT></B> "0 ".'-' x 256 . "\n";                    <I><FONT COLOR=#808080># don't set last and don't care</FONT></I>
   }
 }
}
</PRE></BODY>
<HR>
<FONT SIZE=-2> Generated on Tue Nov 22 15:16:34 CET 2011<BR><A HREF="/~sha3">Home</A></FONT>
</HTML>
